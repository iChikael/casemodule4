<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<button class="btn btn-danger" id="btnCreateProduct">Add product</button>
<div class="modal" id="createProductModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Create Product</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Form content for product creation -->
        <form id="createProductForm">
          <!-- Input fields for product details -->
          <div class="form-group">
            <label for="title">Title</label>
            <input type="text" class="form-control" id="title" placeholder="Enter title">
          </div>
          <div class="form-group">
            <label for="price">Price</label>
            <input type="text" class="form-control" id="price" placeholder="Enter price">
          </div>
          <div class="form-group">
            <label for="description">Description</label>
            <textarea class="form-control" id="description" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="category">Category</label>
            <select class="form-control" id="category">
              <option value="1">Category 1</option>
              <option value="2">Category 2</option>
            </select>
          </div>
          <div class="form-group">
            <label for="unit">Unit</label>
            <select class="form-control" id="unit">
              <option value="1">Unit 1</option>
              <option value="2">Unit 2</option>
            </select>
          </div>
          <div class="form-group">
            <label for="image">Image</label>
            <input type="file" class="form-control-file" id="image">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="btnSaveProduct">Save</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<script>

  document.getElementById("btnCreateProduct").addEventListener("click", function() {
    $('#createProductModal').modal('show');
  });

  document.getElementById("btnSaveProduct").addEventListener("click", function() {
    // Lấy giá trị từ các input fields
    var title = document.getElementById("title").value;
    var price = document.getElementById("price").value;
    var description = document.getElementById("description").value;
    var category = document.getElementById("category").value;
    var unit = document.getElementById("unit").value;
    var image = document.getElementById("image").files[0];

    // Tạo formData để gửi dữ liệu lên server
    var formData = new FormData();
    formData.append("title", title);
    formData.append("price", price);
    formData.append("description", description);
    formData.append("category", category);
    formData.append("unit", unit);
    formData.append("image", image);

    // Gửi request POST đến endpoint để tạo sản phẩm
    fetch("/api/products", {
      method: "POST",
      body: formData
    })
            .then(response => response.json())
            .then(data => {
              // Xử lý kết quả trả về từ server (data)
              console.log(data);
              // Đóng modal sau khi tạo thành công
              $('#createProductModal').modal('hide');
              // Thực hiện các hành động khác sau khi tạo thành công
              // Ví dụ: làm mới danh sách sản phẩm, hiển thị thông báo, vv.
            })
            .catch(error => {
              // Xử lý lỗi nếu có
              console.error(error);
            });
  });


  let doCreateProduct = () => {
    let title = page.dialogs.elements.titleCre.val();
    let price = page.dialogs.elements.priceCre.val();
    let description = page.dialogs.elements.descriptionCre.val();
    let categoryId = page.dialogs.elements.categoryCre.val();
    let unitId = page.dialogs.elements.unitCre.val();
    let image = page.dialogs.elements.imageCre[0].files[0];

    let formData = new FormData();
    formData.append("title", title);
    formData.append("price", price);
    formData.append("description", description);
    formData.append("categoryId", categoryId);
    formData.append("unitId", unitId);
    formData.append("image", image);

    $.ajax({
      headers: {
        'accept': 'application/json',
        'content-type': 'application/json'
      },
      type: "POST",
      url: page.urls.createProduct,
      data: formData,
      processData: false,
      contentType: false
    })
            .done((data) => {
              let product = data;

              $('#modalCreate').modal('hide');
              AppBase.SweetAlert.showSuccessAlert('New product is created successfully');
            })
            .fail((error) => {
              AppBase.SweetAlert.showErrorAlert('Create new product failed');
            })
  }

</script>


</body>
</html>